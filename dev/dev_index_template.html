<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../haoqiyou.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../haoqiyou.ico" type="image/x-icon">
    <title>好骑友网(骑行活动收集器)</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="dev_style.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-51069014-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-51069014-1');
    </script>
    <script>
        function initMap() {
            const centerLocation = { lat: 37.4220656, lng: -122.0840897 };
            const map = new google.maps.Map(document.getElementById('map-container'), {
                center: centerLocation,
                zoom: 10,
                mapId: 'DEMO_MAP_ID'
            });
            // Use the AdvancedMarkerElement
            const marker = new google.maps.marker.AdvancedMarkerElement({
                map: map,
                position: centerLocation,
                title: 'Bay Area Cycling Events'
            });
            
            // Custom Overlay
            class CustomOverlay extends google.maps.OverlayView {
                constructor(map) {
                    super();
                    this.map = map;
                    this.div = null;
                    this.setMap(map);
                }

                onAdd() {
                    this.div = document.createElement('div');
                    this.div.style.borderStyle = 'none';
                    this.div.style.borderWidth = '0px';
                    this.div.style.position = 'absolute';
                    this.div.innerHTML = `{{map_content}}`;
                    const panes = this.getPanes();
                    panes.overlayLayer.appendChild(this.div);
                }

                draw() {
                    const overlayProjection = this.getProjection();
                    const position = overlayProjection.fromLatLngToDivPixel(centerLocation);
                    const div = this.div;
                    div.style.left = position.x + 'px';
                    div.style.top = position.y + 'px';
                }

                onRemove() {
                    if (this.div) {
                        this.div.parentNode.removeChild(this.div);
                        this.div = null;
                    }
                }
            }

            new CustomOverlay(map);
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAAa-YWC_WqDbvhOCOtfl1xmRo3CvRSeck&callback=initMap&libraries=places,geometry"
    ></script>
</head>
<body>
    <div class="top-bar-container">
        <span class="top-bar">好 骑 友</span>  <span>Updated on {{current_time_str_PDT}}</span>
        <label>
            <input type="checkbox" id="toggleExtra">
            <span style="color:#0000ff">只显示精选活动</span>
        </label>
    </div>

    <div class="page-container">
        <div class="list-container">
{{list_content}}
        </div>
        <div class="map-container" id="map-container">
            <!-- The map will be rendered here -->
        </div>
    </div>

    <div class="popup-overlay" id="popup-overlay"></div>
    <div class="popup" id="popup">
        <span class="close-btn" id="close-btn">&times;</span>
        <div id="popup-content"></div>
        <a href="#" id="load-commento-link">点击查看评论区</a>
        <div id="commento" style="display: none;"></div>
    </div>
<script src="../scripts.js"></script>
</body>
</html>